{"diffoscope-json-version": 1, "source1": "first/BCELFactory.class", "source2": "second/BCELFactory.class", "unified_diff": null, "details": [{"source1": "procyon -ec {}", "source2": "procyon -ec {}", "unified_diff": "@@ -54,241 +54,223 @@\n         this.branches = new ArrayList<BranchInstruction>();\n         this.methodGen = mg;\n         this.constantPoolGen = mg.getConstantPool();\n         this.printWriter = out;\n     }\n     \n     private void createConstant(final Object value) {\n-        String embed = value.toString();\n+        String s = value.toString();\n         if (value instanceof String) {\n-            embed = '\\\"' + Utility.convertString(embed) + '\\\"';\n+            s = '\\\"' + Utility.convertString(s) + '\\\"';\n         }\n         else if (value instanceof Character) {\n-            embed = \"(char)0x\" + Integer.toHexString((int)value);\n+            s = \"(char)0x\" + Integer.toHexString((int)value);\n         }\n         else if (value instanceof Float) {\n-            final Float f = (Float)value;\n-            if (Float.isNaN(f)) {\n-                embed = \"Float.NaN\";\n+            final Float n = (Float)value;\n+            if (Float.isNaN(n)) {\n+                s = \"Float.NaN\";\n             }\n-            else if (f == Float.POSITIVE_INFINITY) {\n-                embed = \"Float.POSITIVE_INFINITY\";\n+            else if (n == Float.POSITIVE_INFINITY) {\n+                s = \"Float.POSITIVE_INFINITY\";\n             }\n-            else if (f == Float.NEGATIVE_INFINITY) {\n-                embed = \"Float.NEGATIVE_INFINITY\";\n+            else if (n == Float.NEGATIVE_INFINITY) {\n+                s = \"Float.NEGATIVE_INFINITY\";\n             }\n             else {\n-                embed += \"f\";\n+                s += \"f\";\n             }\n         }\n         else if (value instanceof Double) {\n-            final Double d = (Double)value;\n-            if (Double.isNaN(d)) {\n-                embed = \"Double.NaN\";\n+            final Double n2 = (Double)value;\n+            if (Double.isNaN(n2)) {\n+                s = \"Double.NaN\";\n             }\n-            else if (d == Double.POSITIVE_INFINITY) {\n-                embed = \"Double.POSITIVE_INFINITY\";\n+            else if (n2 == Double.POSITIVE_INFINITY) {\n+                s = \"Double.POSITIVE_INFINITY\";\n             }\n-            else if (d == Double.NEGATIVE_INFINITY) {\n-                embed = \"Double.NEGATIVE_INFINITY\";\n+            else if (n2 == Double.NEGATIVE_INFINITY) {\n+                s = \"Double.NEGATIVE_INFINITY\";\n             }\n             else {\n-                embed += \"d\";\n+                s += \"d\";\n             }\n         }\n         else if (value instanceof Long) {\n-            embed += \"L\";\n+            s += \"L\";\n         }\n         else if (value instanceof ObjectType) {\n-            final ObjectType ot = (ObjectType)value;\n-            embed = \"new ObjectType(\\\"\" + ot.getClassName() + \"\\\")\";\n+            s = \"new ObjectType(\\\"\" + ((ObjectType)value).getClassName() + \"\\\")\";\n         }\n         else if (value instanceof ArrayType) {\n-            final ArrayType at = (ArrayType)value;\n-            embed = \"new ArrayType(\" + BCELifier.printType(at.getBasicType()) + \", \" + at.getDimensions() + \")\";\n+            final ArrayType arrayType = (ArrayType)value;\n+            s = \"new ArrayType(\" + BCELifier.printType(arrayType.getBasicType()) + \", \" + arrayType.getDimensions() + \")\";\n         }\n-        this.printWriter.println(\"il.append(new PUSH(_cp, \" + embed + \"));\");\n+        this.printWriter.println(\"il.append(new PUSH(_cp, \" + s + \"));\");\n     }\n     \n     public void start() {\n         if (!this.methodGen.isAbstract() && !this.methodGen.isNative()) {\n-            for (InstructionHandle ih = this.methodGen.getInstructionList().getStart(); ih != null; ih = ih.getNext()) {\n-                final Instruction i = ih.getInstruction();\n-                if (i instanceof BranchInstruction) {\n-                    this.branchMap.put(i, ih);\n-                }\n-                if (ih.hasTargeters()) {\n-                    if (i instanceof BranchInstruction) {\n-                        this.printWriter.println(\"    InstructionHandle ih_\" + ih.getPosition() + \";\");\n+            for (InstructionHandle instructionHandle = this.methodGen.getInstructionList().getStart(); instructionHandle != null; instructionHandle = instructionHandle.getNext()) {\n+                final Instruction instruction = instructionHandle.getInstruction();\n+                if (instruction instanceof BranchInstruction) {\n+                    this.branchMap.put(instruction, instructionHandle);\n+                }\n+                if (instructionHandle.hasTargeters()) {\n+                    if (instruction instanceof BranchInstruction) {\n+                        this.printWriter.println(\"    InstructionHandle ih_\" + instructionHandle.getPosition() + \";\");\n                     }\n                     else {\n-                        this.printWriter.print(\"    InstructionHandle ih_\" + ih.getPosition() + \" = \");\n+                        this.printWriter.print(\"    InstructionHandle ih_\" + instructionHandle.getPosition() + \" = \");\n                     }\n                 }\n                 else {\n                     this.printWriter.print(\"    \");\n                 }\n-                if (!this.visitInstruction(i)) {\n-                    i.accept((Visitor)this);\n+                if (!this.visitInstruction(instruction)) {\n+                    instruction.accept((Visitor)this);\n                 }\n             }\n             this.updateBranchTargets();\n             this.updateExceptionHandlers();\n         }\n     }\n     \n     private void updateBranchTargets() {\n-        this.branches.forEach(bi -> {\n-            final BranchHandle bh = (BranchHandle)this.branchMap.get(bi);\n-            final int pos = bh.getPosition();\n-            final String name = bi.getName() + \"_\" + pos;\n-            final int targetPos = bh.getTarget().getPosition();\n-            this.printWriter.println(\"    \" + name + \".setTarget(ih_\" + targetPos + \");\");\n-            if (bi instanceof Select) {\n-                final InstructionHandle[] ihs = ((Select)bi).getTargets();\n-                for (int j = 0; j < ihs.length; ++j) {\n-                    final int targetPos2 = ihs[j].getPosition();\n-                    this.printWriter.println(\"    \" + name + \".setTarget(\" + j + \", ih_\" + targetPos2 + \");\");\n+        this.branches.forEach(branchInstruction -> {\n+            final BranchHandle branchHandle = (BranchHandle)this.branchMap.get(branchInstruction);\n+            new StringBuilder().append(branchInstruction.getName()).append(\"_\").append(branchHandle.getPosition()).toString();\n+            final String s;\n+            this.printWriter.println(\"    \" + s + \".setTarget(ih_\" + branchHandle.getTarget().getPosition() + \");\");\n+            if (branchInstruction instanceof Select) {\n+                ((Select)branchInstruction).getTargets();\n+                int i = 0;\n+                final InstructionHandle[] array;\n+                while (i < array.length) {\n+                    this.printWriter.println(\"    \" + s + \".setTarget(\" + i + \", ih_\" + array[i].getPosition() + \");\");\n+                    ++i;\n                 }\n             }\n         });\n     }\n     \n     private void updateExceptionHandlers() {\n-        final CodeExceptionGen[] exceptionHandlers;\n-        final CodeExceptionGen[] handlers = exceptionHandlers = this.methodGen.getExceptionHandlers();\n-        for (final CodeExceptionGen h : exceptionHandlers) {\n-            final String type = (h.getCatchType() == null) ? \"null\" : BCELifier.printType((Type)h.getCatchType());\n-            this.printWriter.println(\"    method.addExceptionHandler(ih_\" + h.getStartPC().getPosition() + \", ih_\" + h.getEndPC().getPosition() + \", ih_\" + h.getHandlerPC().getPosition() + \", \" + type + \");\");\n+        for (final CodeExceptionGen codeExceptionGen : this.methodGen.getExceptionHandlers()) {\n+            this.printWriter.println(\"    method.addExceptionHandler(ih_\" + codeExceptionGen.getStartPC().getPosition() + \", ih_\" + codeExceptionGen.getEndPC().getPosition() + \", ih_\" + codeExceptionGen.getHandlerPC().getPosition() + \", \" + ((codeExceptionGen.getCatchType() == null) ? \"null\" : BCELifier.printType((Type)codeExceptionGen.getCatchType())) + \");\");\n         }\n     }\n     \n     public void visitAllocationInstruction(final AllocationInstruction i) {\n         Type type;\n         if (i instanceof CPInstruction) {\n             type = ((CPInstruction)i).getType(this.constantPoolGen);\n         }\n         else {\n             type = ((NEWARRAY)i).getType();\n         }\n         final short opcode = ((Instruction)i).getOpcode();\n-        int dim = 1;\n+        int dimensions = 1;\n         switch (opcode) {\n             case 187: {\n                 this.printWriter.println(\"il.append(_factory.createNew(\\\"\" + ((ObjectType)type).getClassName() + \"\\\"));\");\n                 break;\n             }\n             case 197: {\n-                dim = ((MULTIANEWARRAY)i).getDimensions();\n+                dimensions = ((MULTIANEWARRAY)i).getDimensions();\n             }\n             case 188: {\n                 if (type instanceof ArrayType) {\n                     type = ((ArrayType)type).getBasicType();\n                 }\n             }\n             case 189: {\n-                this.printWriter.println(\"il.append(_factory.createNewArray(\" + BCELifier.printType(type) + \", (short) \" + dim + \"));\");\n+                this.printWriter.println(\"il.append(_factory.createNewArray(\" + BCELifier.printType(type) + \", (short) \" + dimensions + \"));\");\n                 break;\n             }\n             default: {\n                 throw new IllegalArgumentException(\"Unhandled opcode: \" + opcode);\n             }\n         }\n     }\n     \n     public void visitArrayInstruction(final ArrayInstruction i) {\n-        final short opcode = i.getOpcode();\n-        final Type type = i.getType(this.constantPoolGen);\n-        final String kind = (opcode < 79) ? \"Load\" : \"Store\";\n-        this.printWriter.println(\"il.append(_factory.createArray\" + kind + \"(\" + BCELifier.printType(type) + \"));\");\n+        this.printWriter.println(\"il.append(_factory.createArray\" + ((i.getOpcode() < 79) ? \"Load\" : \"Store\") + \"(\" + BCELifier.printType(i.getType(this.constantPoolGen)) + \"));\");\n     }\n     \n     public void visitBranchInstruction(final BranchInstruction bi) {\n-        final BranchHandle bh = (BranchHandle)this.branchMap.get(bi);\n-        final int pos = bh.getPosition();\n-        final String name = bi.getName() + \"_\" + pos;\n+        final BranchHandle branchHandle = (BranchHandle)this.branchMap.get(bi);\n+        final int position = branchHandle.getPosition();\n+        final String string = bi.getName() + \"_\" + position;\n         if (bi instanceof Select) {\n-            final Select s = (Select)bi;\n+            final Select select = (Select)bi;\n             this.branches.add(bi);\n-            final StringBuilder args = new StringBuilder(\"new int[] { \");\n-            final int[] matchs = s.getMatchs();\n+            final StringBuilder obj = new StringBuilder(\"new int[] { \");\n+            final int[] matchs = select.getMatchs();\n             for (int i = 0; i < matchs.length; ++i) {\n-                args.append(matchs[i]);\n+                obj.append(matchs[i]);\n                 if (i < matchs.length - 1) {\n-                    args.append(\", \");\n+                    obj.append(\", \");\n                 }\n             }\n-            args.append(\" }\");\n-            this.printWriter.print(\"Select \" + name + \" = new \" + bi.getName().toUpperCase(Locale.ENGLISH) + \"(\" + (Object)args + \", new InstructionHandle[] { \");\n-            for (int i = 0; i < matchs.length; ++i) {\n+            obj.append(\" }\");\n+            this.printWriter.print(\"Select \" + string + \" = new \" + bi.getName().toUpperCase(Locale.ENGLISH) + \"(\" + (Object)obj + \", new InstructionHandle[] { \");\n+            for (int j = 0; j < matchs.length; ++j) {\n                 this.printWriter.print(\"null\");\n-                if (i < matchs.length - 1) {\n+                if (j < matchs.length - 1) {\n                     this.printWriter.print(\", \");\n                 }\n             }\n             this.printWriter.println(\" }, null);\");\n         }\n         else {\n-            final int tPos = bh.getTarget().getPosition();\n-            String target;\n-            if (pos > tPos) {\n-                target = \"ih_\" + tPos;\n+            final int position2 = branchHandle.getTarget().getPosition();\n+            String string2;\n+            if (position > position2) {\n+                string2 = \"ih_\" + position2;\n             }\n             else {\n                 this.branches.add(bi);\n-                target = \"null\";\n+                string2 = \"null\";\n             }\n-            this.printWriter.println(\"    BranchInstruction \" + name + \" = _factory.createBranchInstruction(\" + BCELFactory.CONSTANT_PREFIX + bi.getName().toUpperCase(Locale.ENGLISH) + \", \" + target + \");\");\n+            this.printWriter.println(\"    BranchInstruction \" + string + \" = _factory.createBranchInstruction(\" + BCELFactory.CONSTANT_PREFIX + bi.getName().toUpperCase(Locale.ENGLISH) + \", \" + string2 + \");\");\n         }\n-        if (bh.hasTargeters()) {\n-            this.printWriter.println(\"    ih_\" + pos + \" = il.append(\" + name + \");\");\n+        if (branchHandle.hasTargeters()) {\n+            this.printWriter.println(\"    ih_\" + position + \" = il.append(\" + string + \");\");\n         }\n         else {\n-            this.printWriter.println(\"    il.append(\" + name + \");\");\n+            this.printWriter.println(\"    il.append(\" + string + \");\");\n         }\n     }\n     \n     public void visitCHECKCAST(final CHECKCAST i) {\n-        final Type type = i.getType(this.constantPoolGen);\n-        this.printWriter.println(\"il.append(_factory.createCheckCast(\" + BCELifier.printType(type) + \"));\");\n+        this.printWriter.println(\"il.append(_factory.createCheckCast(\" + BCELifier.printType(i.getType(this.constantPoolGen)) + \"));\");\n     }\n     \n     public void visitConstantPushInstruction(final ConstantPushInstruction i) {\n         this.createConstant(i.getValue());\n     }\n     \n     public void visitFieldInstruction(final FieldInstruction i) {\n-        final short opcode = i.getOpcode();\n-        final String className = i.getClassName(this.constantPoolGen);\n-        final String fieldName = i.getFieldName(this.constantPoolGen);\n-        final Type type = i.getFieldType(this.constantPoolGen);\n-        this.printWriter.println(\"il.append(_factory.createFieldAccess(\\\"\" + className + \"\\\", \\\"\" + fieldName + \"\\\", \" + BCELifier.printType(type) + \", \" + BCELFactory.CONSTANT_PREFIX + Const.getOpcodeName((int)opcode).toUpperCase(Locale.ENGLISH) + \"));\");\n+        this.printWriter.println(\"il.append(_factory.createFieldAccess(\\\"\" + i.getClassName(this.constantPoolGen) + \"\\\", \\\"\" + i.getFieldName(this.constantPoolGen) + \"\\\", \" + BCELifier.printType(i.getFieldType(this.constantPoolGen)) + \", \" + BCELFactory.CONSTANT_PREFIX + Const.getOpcodeName((int)i.getOpcode()).toUpperCase(Locale.ENGLISH) + \"));\");\n     }\n     \n     public void visitINSTANCEOF(final INSTANCEOF i) {\n-        final Type type = i.getType(this.constantPoolGen);\n-        this.printWriter.println(\"il.append(_factory.createInstanceOf(\" + BCELifier.printType(type) + \"));\");\n+        this.printWriter.println(\"il.append(_factory.createInstanceOf(\" + BCELifier.printType(i.getType(this.constantPoolGen)) + \"));\");\n     }\n     \n     private boolean visitInstruction(final Instruction i) {\n-        final short opcode = i.getOpcode();\n-        if (InstructionConst.getInstruction((int)opcode) != null && !(i instanceof ConstantPushInstruction) && !(i instanceof ReturnInstruction)) {\n+        if (InstructionConst.getInstruction((int)i.getOpcode()) != null && !(i instanceof ConstantPushInstruction) && !(i instanceof ReturnInstruction)) {\n             this.printWriter.println(\"il.append(InstructionConst.\" + i.getName().toUpperCase(Locale.ENGLISH) + \");\");\n             return true;\n         }\n         return false;\n     }\n     \n     public void visitInvokeInstruction(final InvokeInstruction i) {\n-        final short opcode = i.getOpcode();\n-        final String className = i.getClassName(this.constantPoolGen);\n-        final String methodName = i.getMethodName(this.constantPoolGen);\n-        final Type type = i.getReturnType(this.constantPoolGen);\n-        final Type[] argTypes = i.getArgumentTypes(this.constantPoolGen);\n-        this.printWriter.println(\"il.append(_factory.createInvoke(\\\"\" + className + \"\\\", \\\"\" + methodName + \"\\\", \" + BCELifier.printType(type) + \", \" + BCELifier.printArgumentTypes(argTypes) + \", \" + BCELFactory.CONSTANT_PREFIX + Const.getOpcodeName((int)opcode).toUpperCase(Locale.ENGLISH) + \"));\");\n+        this.printWriter.println(\"il.append(_factory.createInvoke(\\\"\" + i.getClassName(this.constantPoolGen) + \"\\\", \\\"\" + i.getMethodName(this.constantPoolGen) + \"\\\", \" + BCELifier.printType(i.getReturnType(this.constantPoolGen)) + \", \" + BCELifier.printArgumentTypes(i.getArgumentTypes(this.constantPoolGen)) + \", \" + BCELFactory.CONSTANT_PREFIX + Const.getOpcodeName((int)i.getOpcode()).toUpperCase(Locale.ENGLISH) + \"));\");\n     }\n     \n     public void visitLDC(final LDC i) {\n         this.createConstant(i.getValue(this.constantPoolGen));\n     }\n     \n     public void visitLDC2_W(final LDC2_W i) {\n@@ -298,25 +280,23 @@\n     public void visitLocalVariableInstruction(final LocalVariableInstruction i) {\n         final short opcode = i.getOpcode();\n         final Type type = i.getType(this.constantPoolGen);\n         if (opcode == 132) {\n             this.printWriter.println(\"il.append(new IINC(\" + i.getIndex() + \", \" + ((IINC)i).getIncrement() + \"));\");\n         }\n         else {\n-            final String kind = (opcode < 54) ? \"Load\" : \"Store\";\n-            this.printWriter.println(\"il.append(_factory.create\" + kind + \"(\" + BCELifier.printType(type) + \", \" + i.getIndex() + \"));\");\n+            this.printWriter.println(\"il.append(_factory.create\" + ((opcode < 54) ? \"Load\" : \"Store\") + \"(\" + BCELifier.printType(type) + \", \" + i.getIndex() + \"));\");\n         }\n     }\n     \n     public void visitRET(final RET i) {\n         this.printWriter.println(\"il.append(new RET(\" + i.getIndex() + \"));\");\n     }\n     \n     public void visitReturnInstruction(final ReturnInstruction i) {\n-        final Type type = i.getType(this.constantPoolGen);\n-        this.printWriter.println(\"il.append(_factory.createReturn(\" + BCELifier.printType(type) + \"));\");\n+        this.printWriter.println(\"il.append(_factory.createReturn(\" + BCELifier.printType(i.getType(this.constantPoolGen)) + \"));\");\n     }\n     \n     static {\n         CONSTANT_PREFIX = Const.class.getSimpleName() + \".\";\n     }\n }\n"}]}
