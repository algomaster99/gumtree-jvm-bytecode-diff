{"diffoscope-json-version": 1, "source1": "first/FTPClient.class", "source2": "second/FTPClient.class", "unified_diff": null, "details": [{"source1": "procyon -ec {}", "source2": "procyon -ec {}", "unified_diff": "@@ -83,14 +83,18 @@\n     private int controlKeepAliveReplyTimeout;\n     private int[] cslDebug;\n     private FTPClient.HostnameResolver passiveNatWorkaroundStrategy;\n     private static final Pattern PARMS_PAT;\n     private boolean autodetectEncoding;\n     private HashMap<String, Set<String>> featuresMap;\n     \n+    static {\n+        PARMS_PAT = Pattern.compile(\"(\\\\d{1,3},\\\\d{1,3},\\\\d{1,3},\\\\d{1,3}),(\\\\d{1,3}),(\\\\d{1,3})\");\n+    }\n+    \n     private static Properties getOverrideProperties() {\n         return FTPClient.PropertiesSingleton.PROPERTIES;\n     }\n     \n     public FTPClient() {\n         this.controlKeepAliveReplyTimeout = 1000;\n         this.passiveNatWorkaroundStrategy = (FTPClient.HostnameResolver)new FTPClient.NatServerResolverImpl(this);\n@@ -162,26 +166,26 @@\n         }\n         this.passiveHost = (\"0,0,0,0\".equals(m.group(1)) ? this._socket_.getInetAddress().getHostAddress() : m.group(1).replace(',', '.'));\n         try {\n             final int oct1 = Integer.parseInt(m.group(2));\n             final int oct2 = Integer.parseInt(m.group(3));\n             this.passivePort = (oct1 << 8 | oct2);\n         }\n-        catch (final NumberFormatException e) {\n+        catch (final NumberFormatException ex) {\n             throw new MalformedServerReplyException(\"Could not parse passive port information.\\nServer Reply: \" + reply);\n         }\n         if (this.passiveNatWorkaroundStrategy != null) {\n             try {\n                 final String newPassiveHost = this.passiveNatWorkaroundStrategy.resolve(this.passiveHost);\n                 if (!this.passiveHost.equals(newPassiveHost)) {\n                     this.fireReplyReceived(0, \"[Replacing PASV mode reply address \" + this.passiveHost + \" with \" + newPassiveHost + \"]\\n\");\n                     this.passiveHost = newPassiveHost;\n                 }\n             }\n-            catch (final UnknownHostException e2) {\n+            catch (final UnknownHostException ex2) {\n                 throw new MalformedServerReplyException(\"Could not parse passive host information.\\nServer Reply: \" + reply);\n             }\n         }\n     }\n     \n     protected void _parseExtendedPassiveModeReply(String reply) throws MalformedServerReplyException {\n         reply = reply.substring(reply.indexOf(40) + 1, reply.indexOf(41)).trim();\n@@ -192,15 +196,15 @@\n         if (delim1 != delim2 || delim2 != delim3 || delim3 != delim4) {\n             throw new MalformedServerReplyException(\"Could not parse extended passive host information.\\nServer Reply: \" + reply);\n         }\n         int port;\n         try {\n             port = Integer.parseInt(reply.substring(3, reply.length() - 1));\n         }\n-        catch (final NumberFormatException e) {\n+        catch (final NumberFormatException ex) {\n             throw new MalformedServerReplyException(\"Could not parse extended passive host information.\\nServer Reply: \" + reply);\n         }\n         this.passiveHost = this.getRemoteAddress().getHostAddress();\n         this.passivePort = port;\n     }\n     \n     private boolean storeFile(final FTPCmd command, final String remote, final InputStream local) throws IOException {\n@@ -270,47 +274,69 @@\n     }\n     \n     protected Socket _openDataConnection_(final String command, final String arg) throws IOException {\n         if (this.dataConnectionMode != 0 && this.dataConnectionMode != 2) {\n             return null;\n         }\n         final boolean isInet6Address = this.getRemoteAddress() instanceof Inet6Address;\n-        Socket socket;\n-        if (this.dataConnectionMode == 0) {\n-            try (final ServerSocket server = this._serverSocketFactory_.createServerSocket(this.getActivePort(), 1, this.getHostAddress())) {\n-                if (isInet6Address) {\n-                    if (!FTPReply.isPositiveCompletion(this.eprt(this.getReportHostAddress(), server.getLocalPort()))) {\n-                        return null;\n+        Socket socket = null;\n+        Label_0543: {\n+            if (this.dataConnectionMode == 0) {\n+                Throwable t = null;\n+                try {\n+                    final ServerSocket server = this._serverSocketFactory_.createServerSocket(this.getActivePort(), 1, this.getHostAddress());\n+                    try {\n+                        if (isInet6Address) {\n+                            if (!FTPReply.isPositiveCompletion(this.eprt(this.getReportHostAddress(), server.getLocalPort()))) {\n+                                return null;\n+                            }\n+                        }\n+                        else if (!FTPReply.isPositiveCompletion(this.port(this.getReportHostAddress(), server.getLocalPort()))) {\n+                            return null;\n+                        }\n+                        if (this.restartOffset > 0L && !this.restart(this.restartOffset)) {\n+                            return null;\n+                        }\n+                        if (!FTPReply.isPositivePreliminary(this.sendCommand(command, arg))) {\n+                            return null;\n+                        }\n+                        if (this.dataTimeout >= 0) {\n+                            server.setSoTimeout(this.dataTimeout);\n+                        }\n+                        socket = server.accept();\n+                        if (this.dataTimeout >= 0) {\n+                            socket.setSoTimeout(this.dataTimeout);\n+                        }\n+                        if (this.receiveDataSocketBufferSize > 0) {\n+                            socket.setReceiveBufferSize(this.receiveDataSocketBufferSize);\n+                        }\n+                        if (this.sendDataSocketBufferSize > 0) {\n+                            socket.setSendBufferSize(this.sendDataSocketBufferSize);\n+                        }\n+                        break Label_0543;\n+                    }\n+                    finally {\n+                        if (server != null) {\n+                            server.close();\n+                        }\n                     }\n                 }\n-                else if (!FTPReply.isPositiveCompletion(this.port(this.getReportHostAddress(), server.getLocalPort()))) {\n-                    return null;\n-                }\n-                if (this.restartOffset > 0L && !this.restart(this.restartOffset)) {\n-                    return null;\n-                }\n-                if (!FTPReply.isPositivePreliminary(this.sendCommand(command, arg))) {\n-                    return null;\n-                }\n-                if (this.dataTimeout >= 0) {\n-                    server.setSoTimeout(this.dataTimeout);\n-                }\n-                socket = server.accept();\n-                if (this.dataTimeout >= 0) {\n-                    socket.setSoTimeout(this.dataTimeout);\n-                }\n-                if (this.receiveDataSocketBufferSize > 0) {\n-                    socket.setReceiveBufferSize(this.receiveDataSocketBufferSize);\n-                }\n-                if (this.sendDataSocketBufferSize > 0) {\n-                    socket.setSendBufferSize(this.sendDataSocketBufferSize);\n+                finally {\n+                    if (t == null) {\n+                        final Throwable exception;\n+                        t = exception;\n+                    }\n+                    else {\n+                        final Throwable exception;\n+                        if (t != exception) {\n+                            t.addSuppressed(exception);\n+                        }\n+                    }\n                 }\n             }\n-        }\n-        else {\n             final boolean attemptEPSV = this.isUseEPSVwithIPv4() || isInet6Address;\n             if (attemptEPSV && this.epsv() == 229) {\n                 this._parseExtendedPassiveModeReply(this._replyLines.get(0));\n             }\n             else {\n                 if (isInet6Address) {\n                     return null;\n@@ -609,14 +635,15 @@\n                     csl = new FTPClient.CSL(this, this.controlKeepAliveTimeout, this.controlKeepAliveReplyTimeout);\n                 }\n                 Util.copyStream(input, local, this.getBufferSize(), -1L, this.mergeListeners((CopyStreamListener)csl), false);\n             }\n             finally {\n                 Util.closeQuietly((Closeable)input);\n             }\n+            Util.closeQuietly((Closeable)input);\n             return this.completePendingCommand();\n         }\n         finally {\n             Util.closeQuietly(socket);\n             if (csl != null) {\n                 this.cslDebug = csl.cleanUp();\n             }\n@@ -724,15 +751,17 @@\n                 return false;\n             }\n             final boolean success = FTPReply.isPositiveCompletion(replyCode);\n             this.featuresMap = new HashMap<String, Set<String>>();\n             if (!success) {\n                 return false;\n             }\n-            for (final String l : this.getReplyStrings()) {\n+            String[] replyStrings;\n+            for (int length = (replyStrings = this.getReplyStrings()).length, i = 0; i < length; ++i) {\n+                final String l = replyStrings[i];\n                 if (l.startsWith(\" \")) {\n                     String value = \"\";\n                     final int varsep = l.indexOf(32, 1);\n                     String key;\n                     if (varsep > 0) {\n                         key = l.substring(1, varsep);\n                         value = l.substring(varsep + 1);\n@@ -881,22 +910,54 @@\n     \n     public boolean sendNoOp() throws IOException {\n         return FTPReply.isPositiveCompletion(this.noop());\n     }\n     \n     public String[] listNames(final String pathname) throws IOException {\n         final ArrayList<String> results = new ArrayList<String>();\n-        try (final Socket socket = this._openDataConnection_(FTPCmd.NLST, this.getListArguments(pathname))) {\n-            if (socket == null) {\n-                return null;\n+        Throwable t = null;\n+        try {\n+            final Socket socket = this._openDataConnection_(FTPCmd.NLST, this.getListArguments(pathname));\n+            try {\n+                if (socket == null) {\n+                    return null;\n+                }\n+                try {\n+                    final BufferedReader reader = new BufferedReader(new InputStreamReader(socket.getInputStream(), this.getControlEncoding()));\n+                    try {\n+                        String line;\n+                        while ((line = reader.readLine()) != null) {\n+                            results.add(line);\n+                        }\n+                    }\n+                    finally {\n+                        if (reader != null) {\n+                            reader.close();\n+                        }\n+                    }\n+                }\n+                finally {\n+                    return;\n+                }\n             }\n-            try (final BufferedReader reader = new BufferedReader(new InputStreamReader(socket.getInputStream(), this.getControlEncoding()))) {\n-                String line;\n-                while ((line = reader.readLine()) != null) {\n-                    results.add(line);\n+            finally {\n+                if (socket != null) {\n+                    socket.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception;\n+                t = exception;\n+            }\n+            else {\n+                final Throwable exception;\n+                if (t != exception) {\n+                    t.addSuppressed(exception);\n                 }\n             }\n         }\n         if (this.completePendingCommand()) {\n             final String[] names = new String[results.size()];\n             return results.toArray(names);\n         }\n@@ -940,19 +1001,19 @@\n     public FTPListParseEngine initiateListParsing(final String parserKey, final String pathname) throws IOException {\n         this.createParser(parserKey);\n         return this.initiateListParsing(this.entryParser, pathname);\n     }\n     \n     void createParser(final String parserKey) throws IOException {\n         if (this.entryParser == null || (parserKey != null && !this.entryParserKey.equals(parserKey))) {\n-            if (null != parserKey) {\n+            if (parserKey != null) {\n                 this.entryParser = this.parserFactory.createFileEntryParser(parserKey);\n                 this.entryParserKey = parserKey;\n             }\n-            else if (null != this.configuration && this.configuration.getServerSystemKey().length() > 0) {\n+            else if (this.configuration != null && this.configuration.getServerSystemKey().length() > 0) {\n                 this.entryParser = this.parserFactory.createFileEntryParser(this.configuration);\n                 this.entryParserKey = this.configuration.getServerSystemKey();\n             }\n             else {\n                 String systemType = System.getProperty(\"org.apache.commons.net.ftp.systemType\");\n                 if (systemType == null) {\n                     systemType = this.getSystemType();\n@@ -960,15 +1021,15 @@\n                     if (override != null) {\n                         final String newType = override.getProperty(systemType);\n                         if (newType != null) {\n                             systemType = newType;\n                         }\n                     }\n                 }\n-                if (null != this.configuration) {\n+                if (this.configuration != null) {\n                     this.entryParser = this.parserFactory.createFileEntryParser(new FTPClientConfig(systemType, this.configuration));\n                 }\n                 else {\n                     this.entryParser = this.parserFactory.createFileEntryParser(systemType);\n                 }\n                 this.entryParserKey = systemType;\n             }\n@@ -983,14 +1044,15 @@\n         }\n         try {\n             engine.readServerList(socket.getInputStream(), this.getControlEncoding());\n         }\n         finally {\n             Util.closeQuietly(socket);\n         }\n+        Util.closeQuietly(socket);\n         this.completePendingCommand();\n         return engine;\n     }\n     \n     public FTPListParseEngine initiateMListParsing() throws IOException {\n         return this.initiateMListParsing(null);\n     }\n@@ -1004,14 +1066,16 @@\n         try {\n             engine.readServerList(socket.getInputStream(), this.getControlEncoding());\n         }\n         finally {\n             Util.closeQuietly(socket);\n             this.completePendingCommand();\n         }\n+        Util.closeQuietly(socket);\n+        this.completePendingCommand();\n         return engine;\n     }\n     \n     protected String getListArguments(final String pathname) {\n         if (!this.getListHiddenFiles()) {\n             return pathname;\n         }\n@@ -1197,12 +1261,8 @@\n     @Deprecated\n     public String getSystemName() throws IOException {\n         if (this.systemName == null && FTPReply.isPositiveCompletion(this.syst())) {\n             this.systemName = ((String)this._replyLines.get(this._replyLines.size() - 1)).substring(4);\n         }\n         return this.systemName;\n     }\n-    \n-    static {\n-        PARMS_PAT = Pattern.compile(\"(\\\\d{1,3},\\\\d{1,3},\\\\d{1,3},\\\\d{1,3}),(\\\\d{1,3}),(\\\\d{1,3})\");\n-    }\n }\n"}]}
