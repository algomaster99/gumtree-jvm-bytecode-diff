{"diffoscope-json-version": 1, "source1": "first/BCELFactory.class", "source2": "second/BCELFactory.class", "unified_diff": null, "details": [{"source1": "procyon -ec {}", "source2": "procyon -ec {}", "unified_diff": "@@ -45,246 +45,226 @@\n     private static final String CONSTANT_PREFIX;\n     private final MethodGen methodGen;\n     private final PrintWriter printWriter;\n     private final ConstantPoolGen constantPoolGen;\n     private final Map<Instruction, InstructionHandle> branchMap;\n     private final List<BranchInstruction> branches;\n     \n-    BCELFactory(final MethodGen mg, final PrintWriter out) {\n+    BCELFactory(final MethodGen methodGen, final PrintWriter printWriter) {\n         this.branchMap = new HashMap<Instruction, InstructionHandle>();\n         this.branches = new ArrayList<BranchInstruction>();\n-        this.methodGen = mg;\n-        this.constantPoolGen = mg.getConstantPool();\n-        this.printWriter = out;\n+        this.methodGen = methodGen;\n+        this.constantPoolGen = methodGen.getConstantPool();\n+        this.printWriter = printWriter;\n     }\n     \n-    private void createConstant(final Object value) {\n-        String embed = value.toString();\n-        if (value instanceof String) {\n-            embed = '\\\"' + Utility.convertString(embed) + '\\\"';\n+    private void createConstant(final Object o) {\n+        String str = o.toString();\n+        if (o instanceof String) {\n+            str = '\\\"' + Utility.convertString(str) + '\\\"';\n         }\n-        else if (value instanceof Character) {\n-            embed = \"(char)0x\" + Integer.toHexString((int)value);\n+        else if (o instanceof Character) {\n+            str = \"(char)0x\" + Integer.toHexString((int)o);\n         }\n-        else if (value instanceof Float) {\n-            embed += \"f\";\n+        else if (o instanceof Float) {\n+            str += \"f\";\n         }\n-        else if (value instanceof Long) {\n-            embed += \"L\";\n+        else if (o instanceof Long) {\n+            str += \"L\";\n         }\n-        else if (value instanceof ObjectType) {\n-            final ObjectType ot = (ObjectType)value;\n-            embed = \"new ObjectType(\\\"\" + ot.getClassName() + \"\\\")\";\n+        else if (o instanceof ObjectType) {\n+            str = \"new ObjectType(\\\"\" + ((ObjectType)o).getClassName() + \"\\\")\";\n         }\n-        this.printWriter.println(\"il.append(new PUSH(_cp, \" + embed + \"));\");\n+        this.printWriter.println(\"il.append(new PUSH(_cp, \" + str + \"));\");\n     }\n     \n     public void start() {\n         if (!this.methodGen.isAbstract() && !this.methodGen.isNative()) {\n-            for (InstructionHandle ih = this.methodGen.getInstructionList().getStart(); ih != null; ih = ih.getNext()) {\n-                final Instruction i = ih.getInstruction();\n-                if (i instanceof BranchInstruction) {\n-                    this.branchMap.put(i, ih);\n-                }\n-                if (ih.hasTargeters()) {\n-                    if (i instanceof BranchInstruction) {\n-                        this.printWriter.println(\"    InstructionHandle ih_\" + ih.getPosition() + \";\");\n+            for (InstructionHandle instructionHandle = this.methodGen.getInstructionList().getStart(); instructionHandle != null; instructionHandle = instructionHandle.getNext()) {\n+                final Instruction instruction = instructionHandle.getInstruction();\n+                if (instruction instanceof BranchInstruction) {\n+                    this.branchMap.put(instruction, instructionHandle);\n+                }\n+                if (instructionHandle.hasTargeters()) {\n+                    if (instruction instanceof BranchInstruction) {\n+                        this.printWriter.println(\"    InstructionHandle ih_\" + instructionHandle.getPosition() + \";\");\n                     }\n                     else {\n-                        this.printWriter.print(\"    InstructionHandle ih_\" + ih.getPosition() + \" = \");\n+                        this.printWriter.print(\"    InstructionHandle ih_\" + instructionHandle.getPosition() + \" = \");\n                     }\n                 }\n                 else {\n                     this.printWriter.print(\"    \");\n                 }\n-                if (!this.visitInstruction(i)) {\n-                    i.accept((Visitor)this);\n+                if (!this.visitInstruction(instruction)) {\n+                    instruction.accept((Visitor)this);\n                 }\n             }\n             this.updateBranchTargets();\n             this.updateExceptionHandlers();\n         }\n     }\n     \n     private void updateBranchTargets() {\n-        this.branches.forEach(bi -> {\n-            final BranchHandle bh = (BranchHandle)this.branchMap.get(bi);\n-            final int pos = bh.getPosition();\n-            final String name = bi.getName() + \"_\" + pos;\n-            final int targetPos = bh.getTarget().getPosition();\n-            this.printWriter.println(\"    \" + name + \".setTarget(ih_\" + targetPos + \");\");\n-            if (bi instanceof Select) {\n-                final InstructionHandle[] ihs = ((Select)bi).getTargets();\n-                for (int j = 0; j < ihs.length; ++j) {\n-                    final int targetPos2 = ihs[j].getPosition();\n-                    this.printWriter.println(\"    \" + name + \".setTarget(\" + j + \", ih_\" + targetPos2 + \");\");\n+        this.branches.forEach(branchInstruction -> {\n+            final BranchHandle branchHandle = (BranchHandle)this.branchMap.get(branchInstruction);\n+            new StringBuilder().append(branchInstruction.getName()).append(\"_\").append(branchHandle.getPosition()).toString();\n+            final String s;\n+            this.printWriter.println(\"    \" + s + \".setTarget(ih_\" + branchHandle.getTarget().getPosition() + \");\");\n+            if (branchInstruction instanceof Select) {\n+                ((Select)branchInstruction).getTargets();\n+                int i = 0;\n+                final InstructionHandle[] array;\n+                while (i < array.length) {\n+                    this.printWriter.println(\"    \" + s + \".setTarget(\" + i + \", ih_\" + array[i].getPosition() + \");\");\n+                    ++i;\n                 }\n             }\n         });\n     }\n     \n     private void updateExceptionHandlers() {\n-        final CodeExceptionGen[] exceptionHandlers;\n-        final CodeExceptionGen[] handlers = exceptionHandlers = this.methodGen.getExceptionHandlers();\n-        for (final CodeExceptionGen h : exceptionHandlers) {\n-            final String type = (h.getCatchType() == null) ? \"null\" : BCELifier.printType((Type)h.getCatchType());\n-            this.printWriter.println(\"    method.addExceptionHandler(ih_\" + h.getStartPC().getPosition() + \", ih_\" + h.getEndPC().getPosition() + \", ih_\" + h.getHandlerPC().getPosition() + \", \" + type + \");\");\n+        for (final CodeExceptionGen codeExceptionGen : this.methodGen.getExceptionHandlers()) {\n+            this.printWriter.println(\"    method.addExceptionHandler(ih_\" + codeExceptionGen.getStartPC().getPosition() + \", ih_\" + codeExceptionGen.getEndPC().getPosition() + \", ih_\" + codeExceptionGen.getHandlerPC().getPosition() + \", \" + ((codeExceptionGen.getCatchType() == null) ? \"null\" : BCELifier.printType((Type)codeExceptionGen.getCatchType())) + \");\");\n         }\n     }\n     \n-    public void visitAllocationInstruction(final AllocationInstruction i) {\n+    public void visitAllocationInstruction(final AllocationInstruction allocationInstruction) {\n         Type type;\n-        if (i instanceof CPInstruction) {\n-            type = ((CPInstruction)i).getType(this.constantPoolGen);\n+        if (allocationInstruction instanceof CPInstruction) {\n+            type = ((CPInstruction)allocationInstruction).getType(this.constantPoolGen);\n         }\n         else {\n-            type = ((NEWARRAY)i).getType();\n+            type = ((NEWARRAY)allocationInstruction).getType();\n         }\n-        final short opcode = ((Instruction)i).getOpcode();\n-        int dim = 1;\n+        final short opcode = ((Instruction)allocationInstruction).getOpcode();\n+        int dimensions = 1;\n         switch (opcode) {\n             case 187: {\n                 this.printWriter.println(\"il.append(_factory.createNew(\\\"\" + ((ObjectType)type).getClassName() + \"\\\"));\");\n                 break;\n             }\n             case 197: {\n-                dim = ((MULTIANEWARRAY)i).getDimensions();\n+                dimensions = ((MULTIANEWARRAY)allocationInstruction).getDimensions();\n             }\n             case 188:\n             case 189: {\n                 if (type instanceof ArrayType) {\n                     type = ((ArrayType)type).getBasicType();\n                 }\n-                this.printWriter.println(\"il.append(_factory.createNewArray(\" + BCELifier.printType(type) + \", (short) \" + dim + \"));\");\n+                this.printWriter.println(\"il.append(_factory.createNewArray(\" + BCELifier.printType(type) + \", (short) \" + dimensions + \"));\");\n                 break;\n             }\n             default: {\n                 throw new IllegalArgumentException(\"Unhandled opcode: \" + opcode);\n             }\n         }\n     }\n     \n-    public void visitArrayInstruction(final ArrayInstruction i) {\n-        final short opcode = i.getOpcode();\n-        final Type type = i.getType(this.constantPoolGen);\n-        final String kind = (opcode < 79) ? \"Load\" : \"Store\";\n-        this.printWriter.println(\"il.append(_factory.createArray\" + kind + \"(\" + BCELifier.printType(type) + \"));\");\n-    }\n-    \n-    public void visitBranchInstruction(final BranchInstruction bi) {\n-        final BranchHandle bh = (BranchHandle)this.branchMap.get(bi);\n-        final int pos = bh.getPosition();\n-        final String name = bi.getName() + \"_\" + pos;\n-        if (bi instanceof Select) {\n-            final Select s = (Select)bi;\n-            this.branches.add(bi);\n-            final StringBuilder args = new StringBuilder(\"new int[] { \");\n-            final int[] matchs = s.getMatchs();\n+    public void visitArrayInstruction(final ArrayInstruction arrayInstruction) {\n+        this.printWriter.println(\"il.append(_factory.createArray\" + ((arrayInstruction.getOpcode() < 79) ? \"Load\" : \"Store\") + \"(\" + BCELifier.printType(arrayInstruction.getType(this.constantPoolGen)) + \"));\");\n+    }\n+    \n+    public void visitBranchInstruction(final BranchInstruction branchInstruction) {\n+        final BranchHandle branchHandle = (BranchHandle)this.branchMap.get(branchInstruction);\n+        final int position = branchHandle.getPosition();\n+        final String string = branchInstruction.getName() + \"_\" + position;\n+        if (branchInstruction instanceof Select) {\n+            final Select select = (Select)branchInstruction;\n+            this.branches.add(branchInstruction);\n+            final StringBuilder obj = new StringBuilder(\"new int[] { \");\n+            final int[] matchs = select.getMatchs();\n             for (int i = 0; i < matchs.length; ++i) {\n-                args.append(matchs[i]);\n+                obj.append(matchs[i]);\n                 if (i < matchs.length - 1) {\n-                    args.append(\", \");\n+                    obj.append(\", \");\n                 }\n             }\n-            args.append(\" }\");\n-            this.printWriter.print(\"Select \" + name + \" = new \" + bi.getName().toUpperCase(Locale.ENGLISH) + \"(\" + (Object)args + \", new InstructionHandle[] { \");\n-            for (int i = 0; i < matchs.length; ++i) {\n+            obj.append(\" }\");\n+            this.printWriter.print(\"Select \" + string + \" = new \" + branchInstruction.getName().toUpperCase(Locale.ENGLISH) + \"(\" + (Object)obj + \", new InstructionHandle[] { \");\n+            for (int j = 0; j < matchs.length; ++j) {\n                 this.printWriter.print(\"null\");\n-                if (i < matchs.length - 1) {\n+                if (j < matchs.length - 1) {\n                     this.printWriter.print(\", \");\n                 }\n             }\n             this.printWriter.println(\" }, null);\");\n         }\n         else {\n-            final int tPos = bh.getTarget().getPosition();\n-            String target;\n-            if (pos > tPos) {\n-                target = \"ih_\" + tPos;\n+            final int position2 = branchHandle.getTarget().getPosition();\n+            String string2;\n+            if (position > position2) {\n+                string2 = \"ih_\" + position2;\n             }\n             else {\n-                this.branches.add(bi);\n-                target = \"null\";\n+                this.branches.add(branchInstruction);\n+                string2 = \"null\";\n             }\n-            this.printWriter.println(\"    BranchInstruction \" + name + \" = _factory.createBranchInstruction(\" + BCELFactory.CONSTANT_PREFIX + bi.getName().toUpperCase(Locale.ENGLISH) + \", \" + target + \");\");\n+            this.printWriter.println(\"    BranchInstruction \" + string + \" = _factory.createBranchInstruction(\" + BCELFactory.CONSTANT_PREFIX + branchInstruction.getName().toUpperCase(Locale.ENGLISH) + \", \" + string2 + \");\");\n         }\n-        if (bh.hasTargeters()) {\n-            this.printWriter.println(\"    ih_\" + pos + \" = il.append(\" + name + \");\");\n+        if (branchHandle.hasTargeters()) {\n+            this.printWriter.println(\"    ih_\" + position + \" = il.append(\" + string + \");\");\n         }\n         else {\n-            this.printWriter.println(\"    il.append(\" + name + \");\");\n+            this.printWriter.println(\"    il.append(\" + string + \");\");\n         }\n     }\n     \n-    public void visitCHECKCAST(final CHECKCAST i) {\n-        final Type type = i.getType(this.constantPoolGen);\n-        this.printWriter.println(\"il.append(_factory.createCheckCast(\" + BCELifier.printType(type) + \"));\");\n+    public void visitCHECKCAST(final CHECKCAST checkcast) {\n+        this.printWriter.println(\"il.append(_factory.createCheckCast(\" + BCELifier.printType(checkcast.getType(this.constantPoolGen)) + \"));\");\n     }\n     \n-    public void visitConstantPushInstruction(final ConstantPushInstruction i) {\n-        this.createConstant(i.getValue());\n+    public void visitConstantPushInstruction(final ConstantPushInstruction constantPushInstruction) {\n+        this.createConstant(constantPushInstruction.getValue());\n     }\n     \n-    public void visitFieldInstruction(final FieldInstruction i) {\n-        final short opcode = i.getOpcode();\n-        final String className = i.getClassName(this.constantPoolGen);\n-        final String fieldName = i.getFieldName(this.constantPoolGen);\n-        final Type type = i.getFieldType(this.constantPoolGen);\n-        this.printWriter.println(\"il.append(_factory.createFieldAccess(\\\"\" + className + \"\\\", \\\"\" + fieldName + \"\\\", \" + BCELifier.printType(type) + \", \" + BCELFactory.CONSTANT_PREFIX + Const.getOpcodeName((int)opcode).toUpperCase(Locale.ENGLISH) + \"));\");\n+    public void visitFieldInstruction(final FieldInstruction fieldInstruction) {\n+        this.printWriter.println(\"il.append(_factory.createFieldAccess(\\\"\" + fieldInstruction.getClassName(this.constantPoolGen) + \"\\\", \\\"\" + fieldInstruction.getFieldName(this.constantPoolGen) + \"\\\", \" + BCELifier.printType(fieldInstruction.getFieldType(this.constantPoolGen)) + \", \" + BCELFactory.CONSTANT_PREFIX + Const.getOpcodeName((int)fieldInstruction.getOpcode()).toUpperCase(Locale.ENGLISH) + \"));\");\n     }\n     \n-    public void visitINSTANCEOF(final INSTANCEOF i) {\n-        final Type type = i.getType(this.constantPoolGen);\n-        this.printWriter.println(\"il.append(new INSTANCEOF(_cp.addClass(\" + BCELifier.printType(type) + \")));\");\n+    public void visitINSTANCEOF(final INSTANCEOF instanceof1) {\n+        this.printWriter.println(\"il.append(new INSTANCEOF(_cp.addClass(\" + BCELifier.printType(instanceof1.getType(this.constantPoolGen)) + \")));\");\n     }\n     \n-    private boolean visitInstruction(final Instruction i) {\n-        final short opcode = i.getOpcode();\n-        if (InstructionConst.getInstruction((int)opcode) != null && !(i instanceof ConstantPushInstruction) && !(i instanceof ReturnInstruction)) {\n-            this.printWriter.println(\"il.append(InstructionConst.\" + i.getName().toUpperCase(Locale.ENGLISH) + \");\");\n+    private boolean visitInstruction(final Instruction instruction) {\n+        if (InstructionConst.getInstruction((int)instruction.getOpcode()) != null && !(instruction instanceof ConstantPushInstruction) && !(instruction instanceof ReturnInstruction)) {\n+            this.printWriter.println(\"il.append(InstructionConst.\" + instruction.getName().toUpperCase(Locale.ENGLISH) + \");\");\n             return true;\n         }\n         return false;\n     }\n     \n-    public void visitInvokeInstruction(final InvokeInstruction i) {\n-        final short opcode = i.getOpcode();\n-        final String className = i.getClassName(this.constantPoolGen);\n-        final String methodName = i.getMethodName(this.constantPoolGen);\n-        final Type type = i.getReturnType(this.constantPoolGen);\n-        final Type[] argTypes = i.getArgumentTypes(this.constantPoolGen);\n-        this.printWriter.println(\"il.append(_factory.createInvoke(\\\"\" + className + \"\\\", \\\"\" + methodName + \"\\\", \" + BCELifier.printType(type) + \", \" + BCELifier.printArgumentTypes(argTypes) + \", \" + BCELFactory.CONSTANT_PREFIX + Const.getOpcodeName((int)opcode).toUpperCase(Locale.ENGLISH) + \"));\");\n+    public void visitInvokeInstruction(final InvokeInstruction invokeInstruction) {\n+        this.printWriter.println(\"il.append(_factory.createInvoke(\\\"\" + invokeInstruction.getClassName(this.constantPoolGen) + \"\\\", \\\"\" + invokeInstruction.getMethodName(this.constantPoolGen) + \"\\\", \" + BCELifier.printType(invokeInstruction.getReturnType(this.constantPoolGen)) + \", \" + BCELifier.printArgumentTypes(invokeInstruction.getArgumentTypes(this.constantPoolGen)) + \", \" + BCELFactory.CONSTANT_PREFIX + Const.getOpcodeName((int)invokeInstruction.getOpcode()).toUpperCase(Locale.ENGLISH) + \"));\");\n     }\n     \n-    public void visitLDC(final LDC i) {\n-        this.createConstant(i.getValue(this.constantPoolGen));\n+    public void visitLDC(final LDC ldc) {\n+        this.createConstant(ldc.getValue(this.constantPoolGen));\n     }\n     \n-    public void visitLDC2_W(final LDC2_W i) {\n-        this.createConstant(i.getValue(this.constantPoolGen));\n+    public void visitLDC2_W(final LDC2_W ldc2_W) {\n+        this.createConstant(ldc2_W.getValue(this.constantPoolGen));\n     }\n     \n-    public void visitLocalVariableInstruction(final LocalVariableInstruction i) {\n-        final short opcode = i.getOpcode();\n-        final Type type = i.getType(this.constantPoolGen);\n+    public void visitLocalVariableInstruction(final LocalVariableInstruction localVariableInstruction) {\n+        final short opcode = localVariableInstruction.getOpcode();\n+        final Type type = localVariableInstruction.getType(this.constantPoolGen);\n         if (opcode == 132) {\n-            this.printWriter.println(\"il.append(new IINC(\" + i.getIndex() + \", \" + ((IINC)i).getIncrement() + \"));\");\n+            this.printWriter.println(\"il.append(new IINC(\" + localVariableInstruction.getIndex() + \", \" + ((IINC)localVariableInstruction).getIncrement() + \"));\");\n         }\n         else {\n-            final String kind = (opcode < 54) ? \"Load\" : \"Store\";\n-            this.printWriter.println(\"il.append(_factory.create\" + kind + \"(\" + BCELifier.printType(type) + \", \" + i.getIndex() + \"));\");\n+            this.printWriter.println(\"il.append(_factory.create\" + ((opcode < 54) ? \"Load\" : \"Store\") + \"(\" + BCELifier.printType(type) + \", \" + localVariableInstruction.getIndex() + \"));\");\n         }\n     }\n     \n-    public void visitRET(final RET i) {\n-        this.printWriter.println(\"il.append(new RET(\" + i.getIndex() + \")));\");\n+    public void visitRET(final RET ret) {\n+        this.printWriter.println(\"il.append(new RET(\" + ret.getIndex() + \")));\");\n     }\n     \n-    public void visitReturnInstruction(final ReturnInstruction i) {\n-        final Type type = i.getType(this.constantPoolGen);\n-        this.printWriter.println(\"il.append(_factory.createReturn(\" + BCELifier.printType(type) + \"));\");\n+    public void visitReturnInstruction(final ReturnInstruction returnInstruction) {\n+        this.printWriter.println(\"il.append(_factory.createReturn(\" + BCELifier.printType(returnInstruction.getType(this.constantPoolGen)) + \"));\");\n     }\n     \n     static {\n         CONSTANT_PREFIX = Const.class.getSimpleName() + \".\";\n     }\n }\n"}]}
