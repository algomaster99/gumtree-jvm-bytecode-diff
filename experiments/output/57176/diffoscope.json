{"diffoscope-json-version": 1, "source1": "first/IOUtils.class", "source2": "second/IOUtils.class", "unified_diff": null, "details": [{"source1": "procyon -ec {}", "source2": "procyon -ec {}", "unified_diff": "@@ -1,11 +1,10 @@\n \n package org.apache.commons.io;\n \n-import java.util.function.Supplier;\n import org.apache.commons.io.output.AppendableWriter;\n import java.util.Iterator;\n import java.util.Collection;\n import org.apache.commons.io.output.StringBuilderWriter;\n import java.io.ByteArrayInputStream;\n import java.io.CharArrayWriter;\n import java.net.URI;\n@@ -14,15 +13,14 @@\n import org.apache.commons.io.output.ByteArrayOutputStream;\n import java.util.ArrayList;\n import java.util.List;\n import java.io.EOFException;\n import java.nio.ByteBuffer;\n import java.nio.channels.ReadableByteChannel;\n import java.io.FileOutputStream;\n-import java.io.File;\n import java.net.URL;\n import java.io.OutputStreamWriter;\n import java.nio.CharBuffer;\n import java.io.InputStreamReader;\n import java.nio.charset.Charset;\n import org.apache.commons.io.output.NullOutputStream;\n import java.net.Socket;\n@@ -39,14 +37,16 @@\n import java.io.BufferedReader;\n import java.io.Reader;\n import java.io.BufferedOutputStream;\n import java.io.OutputStream;\n import java.util.Objects;\n import java.io.BufferedInputStream;\n import java.io.InputStream;\n+import java.util.function.Supplier;\n+import java.io.File;\n \n public class IOUtils\n {\n     public static final int CR = 13;\n     public static final int DEFAULT_BUFFER_SIZE = 8192;\n     public static final char DIR_SEPARATOR;\n     public static final char DIR_SEPARATOR_UNIX = '/';\n@@ -57,14 +57,24 @@\n     @Deprecated\n     public static final String LINE_SEPARATOR;\n     public static final String LINE_SEPARATOR_UNIX;\n     public static final String LINE_SEPARATOR_WINDOWS;\n     private static final ThreadLocal<byte[]> SKIP_BYTE_BUFFER;\n     private static final ThreadLocal<char[]> SKIP_CHAR_BUFFER;\n     \n+    static {\n+        DIR_SEPARATOR = File.separatorChar;\n+        EMPTY_BYTE_ARRAY = new byte[0];\n+        LINE_SEPARATOR = System.lineSeparator();\n+        LINE_SEPARATOR_UNIX = StandardLineSeparator.LF.getString();\n+        LINE_SEPARATOR_WINDOWS = StandardLineSeparator.CRLF.getString();\n+        SKIP_BYTE_BUFFER = ThreadLocal.withInitial((Supplier<? extends byte[]>)IOUtils::byteArray);\n+        SKIP_CHAR_BUFFER = ThreadLocal.withInitial((Supplier<? extends char[]>)IOUtils::charArray);\n+    }\n+    \n     public static BufferedInputStream buffer(final InputStream inputStream) {\n         Objects.requireNonNull(inputStream, \"inputStream\");\n         return (inputStream instanceof BufferedInputStream) ? ((BufferedInputStream)inputStream) : new BufferedInputStream(inputStream);\n     }\n     \n     public static BufferedInputStream buffer(final InputStream inputStream, final int size) {\n         Objects.requireNonNull(inputStream, \"inputStream\");\n@@ -360,22 +370,64 @@\n         if (count > 2147483647L) {\n             return -1;\n         }\n         return (int)count;\n     }\n     \n     public static long copy(final URL url, final File file) throws IOException {\n-        try (final FileOutputStream outputStream = new FileOutputStream(Objects.requireNonNull(file, \"file\"))) {\n-            return copy(url, outputStream);\n+        Throwable t = null;\n+        try {\n+            final FileOutputStream outputStream = new FileOutputStream(Objects.requireNonNull(file, \"file\"));\n+            try {\n+                return copy(url, outputStream);\n+            }\n+            finally {\n+                if (outputStream != null) {\n+                    outputStream.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception;\n+                t = exception;\n+            }\n+            else {\n+                final Throwable exception;\n+                if (t != exception) {\n+                    t.addSuppressed(exception);\n+                }\n+            }\n         }\n     }\n     \n     public static long copy(final URL url, final OutputStream outputStream) throws IOException {\n-        try (final InputStream inputStream = ((URL)Objects.requireNonNull(url, \"url\")).openStream()) {\n-            return copyLarge(inputStream, outputStream);\n+        Throwable t = null;\n+        try {\n+            final InputStream inputStream = ((URL)Objects.requireNonNull(url, \"url\")).openStream();\n+            try {\n+                return copyLarge(inputStream, outputStream);\n+            }\n+            finally {\n+                if (inputStream != null) {\n+                    inputStream.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception;\n+                t = exception;\n+            }\n+            else {\n+                final Throwable exception;\n+                if (t != exception) {\n+                    t.addSuppressed(exception);\n+                }\n+            }\n         }\n     }\n     \n     public static long copyLarge(final InputStream inputStream, final OutputStream outputStream) throws IOException {\n         return copy(inputStream, outputStream, 8192);\n     }\n     \n@@ -651,16 +703,16 @@\n         if (toSkip < 0L) {\n             throw new IllegalArgumentException(\"Skip count must be non-negative, actual: \" + toSkip);\n         }\n         final ByteBuffer skipByteBuffer = ByteBuffer.allocate((int)Math.min(toSkip, 8192L));\n         long remain;\n         int n;\n         for (remain = toSkip; remain > 0L; remain -= n) {\n-            skipByteBuffer.position();\n-            skipByteBuffer.limit();\n+            skipByteBuffer.position(0);\n+            skipByteBuffer.limit((int)Math.min(remain, 8192L));\n             n = input.read(skipByteBuffer);\n             if (n == -1) {\n                 break;\n             }\n         }\n         return toSkip - remain;\n     }\n@@ -721,20 +773,65 @@\n     }\n     \n     public static BufferedReader toBufferedReader(final Reader reader, final int size) {\n         return (reader instanceof BufferedReader) ? ((BufferedReader)reader) : new BufferedReader(reader, size);\n     }\n     \n     public static byte[] toByteArray(final InputStream inputStream) throws IOException {\n-        try (final UnsynchronizedByteArrayOutputStream ubaOutput = new UnsynchronizedByteArrayOutputStream();\n-             final ThresholdingOutputStream thresholdOuput = new ThresholdingOutputStream(Integer.MAX_VALUE, os -> {\n-            throw new IllegalArgumentException(String.format(\"Cannot read more than %,d into a byte array\", Integer.valueOf(Integer.MAX_VALUE)));\n-        }, os -> ubaOutput)) {\n-            copy(inputStream, (OutputStream)thresholdOuput);\n-            return ubaOutput.toByteArray();\n+        Throwable t = null;\n+        try {\n+            final UnsynchronizedByteArrayOutputStream ubaOutput = new UnsynchronizedByteArrayOutputStream();\n+            try {\n+                final ThresholdingOutputStream thresholdOuput = new ThresholdingOutputStream(Integer.MAX_VALUE, os -> {\n+                    throw new IllegalArgumentException(String.format(\"Cannot read more than %,d into a byte array\", Integer.valueOf(Integer.MAX_VALUE)));\n+                }, os -> ubaOutput);\n+                try {\n+                    copy(inputStream, (OutputStream)thresholdOuput);\n+                    final byte[] byteArray = ubaOutput.toByteArray();\n+                    if (thresholdOuput != null) {\n+                        thresholdOuput.close();\n+                    }\n+                    if (ubaOutput != null) {\n+                        ubaOutput.close();\n+                    }\n+                    return byteArray;\n+                }\n+                finally {\n+                    if (thresholdOuput != null) {\n+                        thresholdOuput.close();\n+                    }\n+                }\n+            }\n+            finally {\n+                if (t == null) {\n+                    final Throwable exception;\n+                    t = exception;\n+                }\n+                else {\n+                    final Throwable exception;\n+                    if (t != exception) {\n+                        t.addSuppressed(exception);\n+                    }\n+                }\n+                if (ubaOutput != null) {\n+                    ubaOutput.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception2;\n+                t = exception2;\n+            }\n+            else {\n+                final Throwable exception2;\n+                if (t != exception2) {\n+                    t.addSuppressed(exception2);\n+                }\n+            }\n         }\n     }\n     \n     public static byte[] toByteArray(final InputStream input, final int size) throws IOException {\n         if (size < 0) {\n             throw new IllegalArgumentException(\"Size must be equal or greater than zero: \" + size);\n         }\n@@ -760,17 +857,38 @@\n     \n     @Deprecated\n     public static byte[] toByteArray(final Reader reader) throws IOException {\n         return toByteArray(reader, Charset.defaultCharset());\n     }\n     \n     public static byte[] toByteArray(final Reader reader, final Charset charset) throws IOException {\n-        try (final ByteArrayOutputStream output = new ByteArrayOutputStream()) {\n-            copy(reader, (OutputStream)output, charset);\n-            return output.toByteArray();\n+        Throwable t = null;\n+        try {\n+            final ByteArrayOutputStream output = new ByteArrayOutputStream();\n+            try {\n+                copy(reader, (OutputStream)output, charset);\n+                return output.toByteArray();\n+            }\n+            finally {\n+                if (output != null) {\n+                    output.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception;\n+                t = exception;\n+            }\n+            else {\n+                final Throwable exception;\n+                if (t != exception) {\n+                    t.addSuppressed(exception);\n+                }\n+            }\n         }\n     }\n     \n     public static byte[] toByteArray(final Reader reader, final String charsetName) throws IOException {\n         return toByteArray(reader, Charsets.toCharset(charsetName));\n     }\n     \n@@ -790,16 +908,37 @@\n         }\n         finally {\n             close(conn);\n         }\n     }\n     \n     public static byte[] toByteArray(final URLConnection urlConn) throws IOException {\n-        try (final InputStream inputStream = urlConn.getInputStream()) {\n-            return toByteArray(inputStream);\n+        Throwable t = null;\n+        try {\n+            final InputStream inputStream = urlConn.getInputStream();\n+            try {\n+                return toByteArray(inputStream);\n+            }\n+            finally {\n+                if (inputStream != null) {\n+                    inputStream.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception;\n+                t = exception;\n+            }\n+            else {\n+                final Throwable exception;\n+                if (t != exception) {\n+                    t.addSuppressed(exception);\n+                }\n+            }\n         }\n     }\n     \n     @Deprecated\n     public static char[] toCharArray(final InputStream inputStream) throws IOException {\n         return toCharArray(inputStream, Charset.defaultCharset());\n     }\n@@ -858,28 +997,70 @@\n     \n     @Deprecated\n     public static String toString(final InputStream input) throws IOException {\n         return toString(input, Charset.defaultCharset());\n     }\n     \n     public static String toString(final InputStream input, final Charset charset) throws IOException {\n-        try (final StringBuilderWriter sw = new StringBuilderWriter()) {\n-            copy(input, (Writer)sw, charset);\n-            return sw.toString();\n+        Throwable t = null;\n+        try {\n+            final StringBuilderWriter sw = new StringBuilderWriter();\n+            try {\n+                copy(input, (Writer)sw, charset);\n+                return sw.toString();\n+            }\n+            finally {\n+                if (sw != null) {\n+                    sw.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception;\n+                t = exception;\n+            }\n+            else {\n+                final Throwable exception;\n+                if (t != exception) {\n+                    t.addSuppressed(exception);\n+                }\n+            }\n         }\n     }\n     \n     public static String toString(final InputStream input, final String charsetName) throws IOException {\n         return toString(input, Charsets.toCharset(charsetName));\n     }\n     \n     public static String toString(final Reader reader) throws IOException {\n-        try (final StringBuilderWriter sw = new StringBuilderWriter()) {\n-            copy(reader, (Writer)sw);\n-            return sw.toString();\n+        Throwable t = null;\n+        try {\n+            final StringBuilderWriter sw = new StringBuilderWriter();\n+            try {\n+                copy(reader, (Writer)sw);\n+                return sw.toString();\n+            }\n+            finally {\n+                if (sw != null) {\n+                    sw.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception;\n+                t = exception;\n+            }\n+            else {\n+                final Throwable exception;\n+                if (t != exception) {\n+                    t.addSuppressed(exception);\n+                }\n+            }\n         }\n     }\n     \n     @Deprecated\n     public static String toString(final URI uri) throws IOException {\n         return toString(uri, Charset.defaultCharset());\n     }\n@@ -894,16 +1075,37 @@\n     \n     @Deprecated\n     public static String toString(final URL url) throws IOException {\n         return toString(url, Charset.defaultCharset());\n     }\n     \n     public static String toString(final URL url, final Charset encoding) throws IOException {\n-        try (final InputStream inputStream = url.openStream()) {\n-            return toString(inputStream, encoding);\n+        Throwable t = null;\n+        try {\n+            final InputStream inputStream = url.openStream();\n+            try {\n+                return toString(inputStream, encoding);\n+            }\n+            finally {\n+                if (inputStream != null) {\n+                    inputStream.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception;\n+                t = exception;\n+            }\n+            else {\n+                final Throwable exception;\n+                if (t != exception) {\n+                    t.addSuppressed(exception);\n+                }\n+            }\n         }\n     }\n     \n     public static String toString(final URL url, final String charsetName) throws IOException {\n         return toString(url, Charsets.toCharset(charsetName));\n     }\n     \n@@ -1076,18 +1278,8 @@\n             return (Writer)appendable;\n         }\n         if (appendable instanceof StringBuilder) {\n             return (Writer)new StringBuilderWriter((StringBuilder)appendable);\n         }\n         return (Writer)new AppendableWriter(appendable);\n     }\n-    \n-    static {\n-        DIR_SEPARATOR = File.separatorChar;\n-        EMPTY_BYTE_ARRAY = new byte[0];\n-        LINE_SEPARATOR = System.lineSeparator();\n-        LINE_SEPARATOR_UNIX = StandardLineSeparator.LF.getString();\n-        LINE_SEPARATOR_WINDOWS = StandardLineSeparator.CRLF.getString();\n-        SKIP_BYTE_BUFFER = ThreadLocal.withInitial((Supplier<? extends byte[]>)IOUtils::byteArray);\n-        SKIP_CHAR_BUFFER = ThreadLocal.withInitial((Supplier<? extends char[]>)IOUtils::charArray);\n-    }\n }\n"}]}
