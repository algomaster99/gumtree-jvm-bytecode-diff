{"diffoscope-json-version": 1, "source1": "first/Class2HTML.class", "source2": "second/Class2HTML.class", "unified_diff": null, "details": [{"source1": "procyon -ec {}", "source2": "procyon -ec {}", "unified_diff": "@@ -1,48 +1,60 @@\n \n package org.apache.bcel.util;\n \n-import java.util.HashSet;\n import org.apache.bcel.classfile.Attribute;\n import java.io.PrintWriter;\n import org.apache.bcel.classfile.Method;\n import java.nio.charset.Charset;\n import java.nio.charset.StandardCharsets;\n import org.apache.bcel.classfile.Utility;\n import java.io.IOException;\n import org.apache.bcel.classfile.ClassParser;\n import java.io.File;\n+import java.util.HashSet;\n import org.apache.bcel.classfile.JavaClass;\n import java.util.Set;\n import org.apache.bcel.classfile.ConstantPool;\n import org.apache.bcel.Constants;\n \n public class Class2HTML implements Constants\n {\n     private static String classPackage;\n     private static String className;\n     private static ConstantPool constantPool;\n     private static final Set<String> basicTypes;\n     private final JavaClass javaClass;\n     private final String dir;\n     \n+    static {\n+        (basicTypes = new HashSet<String>()).add(\"int\");\n+        Class2HTML.basicTypes.add(\"short\");\n+        Class2HTML.basicTypes.add(\"boolean\");\n+        Class2HTML.basicTypes.add(\"void\");\n+        Class2HTML.basicTypes.add(\"char\");\n+        Class2HTML.basicTypes.add(\"byte\");\n+        Class2HTML.basicTypes.add(\"long\");\n+        Class2HTML.basicTypes.add(\"double\");\n+        Class2HTML.basicTypes.add(\"float\");\n+    }\n+    \n     public static void main(final String[] argv) throws IOException {\n         final String[] fileName = new String[argv.length];\n         int files = 0;\n         ClassParser parser = null;\n         JavaClass javaClass = null;\n         String zipFile = null;\n         final char sep = File.separatorChar;\n         String dir = \".\" + sep;\n         for (int i = 0; i < argv.length; ++i) {\n             if (argv[i].charAt(0) == '-') {\n                 if (argv[i].equals(\"-d\")) {\n                     dir = argv[++i];\n-                    if (!dir.endsWith(\"\" + sep)) {\n-                        dir += sep;\n+                    if (!dir.endsWith(new StringBuilder().append(sep).toString())) {\n+                        dir = String.valueOf(dir) + sep;\n                     }\n                     final File store = new File(dir);\n                     if (!store.isDirectory()) {\n                         final boolean created = store.mkdirs();\n                         if (!created && !store.isDirectory()) {\n                             System.out.println(\"Tried to create the directory \" + dir + \" but failed\");\n                         }\n@@ -77,21 +89,21 @@\n             }\n         }\n     }\n     \n     static String referenceClass(final int index) {\n         String str = Class2HTML.constantPool.getConstantString(index, (byte)7);\n         str = Utility.compactClassName(str);\n-        str = Utility.compactClassName(str, Class2HTML.classPackage + \".\", true);\n+        str = Utility.compactClassName(str, String.valueOf(Class2HTML.classPackage) + \".\", true);\n         return \"<A HREF=\\\"\" + Class2HTML.className + \"_cp.html#cp\" + index + \"\\\" TARGET=ConstantPool>\" + str + \"</A>\";\n     }\n     \n     static String referenceType(final String type) {\n         String shortType = Utility.compactClassName(type);\n-        shortType = Utility.compactClassName(shortType, Class2HTML.classPackage + \".\", true);\n+        shortType = Utility.compactClassName(shortType, String.valueOf(Class2HTML.classPackage) + \".\", true);\n         final int index = type.indexOf(91);\n         String baseType = type;\n         if (index > -1) {\n             baseType = type.substring(0, index);\n         }\n         if (Class2HTML.basicTypes.contains(baseType)) {\n             return \"<FONT COLOR=\\\"#00FF00\\\">\" + type + \"</FONT>\";\n@@ -143,36 +155,66 @@\n         if (index > -1) {\n             Class2HTML.classPackage = Class2HTML.className.substring(0, index);\n         }\n         else {\n             Class2HTML.classPackage = \"\";\n         }\n         final ConstantHTML constantHtml = new ConstantHTML(dir, Class2HTML.className, Class2HTML.classPackage, methods, Class2HTML.constantPool, charset);\n-        try (final AttributeHTML attributeHtml = new AttributeHTML(dir, Class2HTML.className, Class2HTML.constantPool, constantHtml, charset)) {\n-            new MethodHTML(dir, Class2HTML.className, methods, javaClass.getFields(), constantHtml, attributeHtml, charset);\n-            this.writeMainHTML(attributeHtml, charset);\n-            new CodeHTML(dir, Class2HTML.className, methods, Class2HTML.constantPool, constantHtml, charset);\n+        Throwable t = null;\n+        try {\n+            final AttributeHTML attributeHtml = new AttributeHTML(dir, Class2HTML.className, Class2HTML.constantPool, constantHtml, charset);\n+            try {\n+                new MethodHTML(dir, Class2HTML.className, methods, javaClass.getFields(), constantHtml, attributeHtml, charset);\n+                this.writeMainHTML(attributeHtml, charset);\n+                new CodeHTML(dir, Class2HTML.className, methods, Class2HTML.constantPool, constantHtml, charset);\n+            }\n+            finally {\n+                if (attributeHtml != null) {\n+                    attributeHtml.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception;\n+                t = exception;\n+            }\n+            else {\n+                final Throwable exception;\n+                if (t != exception) {\n+                    t.addSuppressed(exception);\n+                }\n+            }\n         }\n     }\n     \n     private void writeMainHTML(final AttributeHTML attributeHtml, final Charset charset) throws IOException {\n-        try (final PrintWriter file = new PrintWriter(this.dir + Class2HTML.className + \".html\", charset.name())) {\n-            file.println(\"<HTML>\\n<HEAD><TITLE>Documentation for \" + Class2HTML.className + \"</TITLE></HEAD>\\n<FRAMESET BORDER=1 cols=\\\"30%,*\\\">\\n<FRAMESET BORDER=1 rows=\\\"80%,*\\\">\\n<FRAME NAME=\\\"ConstantPool\\\" SRC=\\\"\" + Class2HTML.className + \"_cp.html\\\"\\n MARGINWIDTH=\\\"0\\\" MARGINHEIGHT=\\\"0\\\" FRAMEBORDER=\\\"1\\\" SCROLLING=\\\"AUTO\\\">\\n<FRAME NAME=\\\"Attributes\\\" SRC=\\\"\" + Class2HTML.className + \"_attributes.html\\\"\\n MARGINWIDTH=\\\"0\\\" MARGINHEIGHT=\\\"0\\\" FRAMEBORDER=\\\"1\\\" SCROLLING=\\\"AUTO\\\">\\n</FRAMESET>\\n<FRAMESET BORDER=1 rows=\\\"80%,*\\\">\\n<FRAME NAME=\\\"Code\\\" SRC=\\\"\" + Class2HTML.className + \"_code.html\\\"\\n MARGINWIDTH=0 MARGINHEIGHT=0 FRAMEBORDER=1 SCROLLING=\\\"AUTO\\\">\\n<FRAME NAME=\\\"Methods\\\" SRC=\\\"\" + Class2HTML.className + \"_methods.html\\\"\\n MARGINWIDTH=0 MARGINHEIGHT=0 FRAMEBORDER=1 SCROLLING=\\\"AUTO\\\">\\n</FRAMESET></FRAMESET></HTML>\");\n+        Throwable t = null;\n+        try {\n+            final PrintWriter file = new PrintWriter(String.valueOf(this.dir) + Class2HTML.className + \".html\", charset.name());\n+            try {\n+                file.println(\"<HTML>\\n<HEAD><TITLE>Documentation for \" + Class2HTML.className + \"</TITLE>\" + \"</HEAD>\\n\" + \"<FRAMESET BORDER=1 cols=\\\"30%,*\\\">\\n\" + \"<FRAMESET BORDER=1 rows=\\\"80%,*\\\">\\n\" + \"<FRAME NAME=\\\"ConstantPool\\\" SRC=\\\"\" + Class2HTML.className + \"_cp.html\" + \"\\\"\\n MARGINWIDTH=\\\"0\\\" \" + \"MARGINHEIGHT=\\\"0\\\" FRAMEBORDER=\\\"1\\\" SCROLLING=\\\"AUTO\\\">\\n\" + \"<FRAME NAME=\\\"Attributes\\\" SRC=\\\"\" + Class2HTML.className + \"_attributes.html\" + \"\\\"\\n MARGINWIDTH=\\\"0\\\" \" + \"MARGINHEIGHT=\\\"0\\\" FRAMEBORDER=\\\"1\\\" SCROLLING=\\\"AUTO\\\">\\n\" + \"</FRAMESET>\\n\" + \"<FRAMESET BORDER=1 rows=\\\"80%,*\\\">\\n\" + \"<FRAME NAME=\\\"Code\\\" SRC=\\\"\" + Class2HTML.className + \"_code.html\\\"\\n MARGINWIDTH=0 \" + \"MARGINHEIGHT=0 FRAMEBORDER=1 SCROLLING=\\\"AUTO\\\">\\n\" + \"<FRAME NAME=\\\"Methods\\\" SRC=\\\"\" + Class2HTML.className + \"_methods.html\\\"\\n MARGINWIDTH=0 \" + \"MARGINHEIGHT=0 FRAMEBORDER=1 SCROLLING=\\\"AUTO\\\">\\n\" + \"</FRAMESET></FRAMESET></HTML>\");\n+            }\n+            finally {\n+                if (file != null) {\n+                    file.close();\n+                }\n+            }\n+        }\n+        finally {\n+            if (t == null) {\n+                final Throwable exception;\n+                t = exception;\n+            }\n+            else {\n+                final Throwable exception;\n+                if (t != exception) {\n+                    t.addSuppressed(exception);\n+                }\n+            }\n         }\n         final Attribute[] attributes = this.javaClass.getAttributes();\n         for (int i = 0; i < attributes.length; ++i) {\n             attributeHtml.writeAttribute(attributes[i], \"class\" + i);\n         }\n     }\n-    \n-    static {\n-        (basicTypes = new HashSet<String>()).add(\"int\");\n-        Class2HTML.basicTypes.add(\"short\");\n-        Class2HTML.basicTypes.add(\"boolean\");\n-        Class2HTML.basicTypes.add(\"void\");\n-        Class2HTML.basicTypes.add(\"char\");\n-        Class2HTML.basicTypes.add(\"byte\");\n-        Class2HTML.basicTypes.add(\"long\");\n-        Class2HTML.basicTypes.add(\"double\");\n-        Class2HTML.basicTypes.add(\"float\");\n-    }\n }\n"}]}
